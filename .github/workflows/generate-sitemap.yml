name: Generate and Update sitemap.xml

on:
  push:
    branches:
      - main          # ← change to master if your default branch is master
    paths:
      - '**.html'     # optional: only run if HTML files changed (speeds it up)
      - '**.md'       # add other extensions if needed
      - '!sitemap.xml' # don't trigger on sitemap itself (prevents loops)

jobs:
  generate-sitemap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # important: needed for git commit history / lastmod dates

      - name: Generate sitemap.xml
        uses: cicirello/generate-sitemap@v1
        with:
          base-url-path: https://revisionmasters.in      # ← YOUR SITE URL HERE (no trailing slash)
          # OR if custom domain: https://www.yourdomain.com
          # path-to-robots-txt: robots.txt                       # optional
          sitemap-format: xml                                    # or txt if you prefer
          # change-frequency: daily                              # optional default
          # priority: 0.7                                        # optional default
          # exclude: /private/, /admin.html                      # optional patterns to skip

      - name: Commit and push new sitemap if changed
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add sitemap.xml
          if git diff --staged --quiet; then
            echo "sitemap.xml unchanged - nothing to commit"
          else
            git commit -m "chore: auto-update sitemap.xml [ci skip]"
            git push
          fi